define job load_ventes_from_ventes1
description 'Load stg.ventes1 to core.ventes1 table'
(
    define schema ventes_schema
    (
        LocID       numeric,
        TPVID       varchar(50),
        TkNum       numeric,
        TkDT        date,
        TkHR        time,
        VisID       varchar(50),
        VisTypeCD   varchar(50),
        CliID       integer,
        CliStatCD   varchar(50),
        TklNetAmt   varchar(50),
        Qty         varchar(50),
        Mesure      varchar(50),
        ItemID      varchar(50),
        RemAmt      varchar(50)
    );

    define operator export_ventes
    type export
    schema ventes_schema
    attributes
    (
        varchar UserName = 'prdw_reader_stg',
        varchar UserPassword = 'prdw_reader_stg',
        varchar SelectSmt = 'select unique
                                cast(TkNum as integer),
                                cast(LocID as integer),
                                cast(PAYCMD as integer),
                                cast(CliID as integer),
                                cast(TkDT as date format ''MM/DD/YY''),
                                cast(TkHR as time format ''99:99:99'')
                             from DB_PRDW_STG.ventes1
                             where
                                TkDT like ''%31/12/13%'' and
                                TkHR like ''%24:60:60%'';'
    );

    define operator load_ventes
    type load
    schema ventes_schema
    attributes
    (
        varchar UserName = 'prdw_reader_core',
        varchar UserPassword = 'prdw_reader_core',
        varchar TargetTable = 'DB_PRDW_CORE.f_ticket',
        varchar LogTable = 'DB_PRDW_CORE.log_f_ticket'
    );

    apply ('insert into DB_PRDW_CORE.f_ticket(
            num_ticket, id_magasin, moyen_paiement, id_client, dt_ticket,
            heure)
        values (:tknum, :locid, :paycmd, :cliid, :tkdt, :tkhr);')
    to operator (load_ventes[1])

    select TkNum, LocID, PAYCMD, CliID, TkDT, TkHR
    from operator (file_reader[1]);
);
